<!DOCTYPE html>
<html lang=en>
<head>
<title>ESP Editor</title>
<style type=text/css media=screen>.cm{z-index:300;position:absolute;left:5px;border:1px solid #444;background-color:#f5f5f5;display:none;box-shadow:0 0 10px rgba(0,0,0,.4);font-size:12px;font-family:sans-serif;font-weight:bold}.cm ul{list-style:none;top:0;left:0;margin:0;padding:0}.cm li{position:relative;min-width:60px;cursor:pointer}.cm span{color:#444;display:inline-block;padding:6px}.cm li:hover{background:#444}.cm li:hover span{color:#EEE}.tvu ul,.tvu li{padding:0;margin:0;list-style:none}.tvu input{position:absolute;opacity:0}.tvu{font:normal 12px Verdana,Arial,Sans-serif;-moz-user-select:none;-webkit-user-select:none;user-select:none;color:#444;line-height:16px}.tvu span{margin-bottom:5px;padding:0 0 0 18px;cursor:pointer;display:inline-block;height:16px;vertical-align:middle;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAADoSURBVBgZBcExblNBGAbA2ceegTRBuIKOgiihSZNTcC5LUHAihNJR0kGKCDcYJY6D3/77MdOinTvzAgCw8ysThIvn/VojIyMjIyPP+bS1sUQIV2s95pBDDvmbP/mdkft83tpYguZq5Jh/OeaYh+yzy8hTHvNlaxNNczm+la9OTlar1UdA/+C2A4trRCnD3jS8BB1obq2Gk6GU6QbQAS4BUaYSQAf4bhhKKTFdAzrAOwAxEUAH+KEM01SY3gM6wBsEAQB0gJ+maZoC3gI6iPYaAIBJsiRmHU0AALOeFC3aK2cWAACUXe7+AwO0lc9eTHYTAAAAAElFTkSuQmCC') no-repeat;background-position:0 0}.tvu span:hover{text-decoration:underline}@media screen and (-webkit-min-device-pixel-ratio:0){.tvu{-webkit-animation:webkit-adjacent-element-selector-bugfix infinite 1s}@-webkit-keyframes webkit-adjacent-element-selector-bugfix{from{padding:0}to{padding:0}}}#uploader{position:absolute;top:0;right:0;left:0;height:28px;line-height:24px;padding-left:10px;background-color:#444;color:#EEE}#tree{position:absolute;top:28px;bottom:0;left:0;width:160px;padding:8px}#editor,#preview{position:absolute;top:28px;right:0;bottom:0;left:160px;border-left:1px solid #EEE}#preview{background-color:#EEE;padding:5px}#loader{position:absolute;top:36%;right:40%}.loader{z-index:10000;border:8px solid #b5b5b5;border-top:8px solid #3498db;border-bottom:8px solid #3498db;border-radius:50%;width:240px;height:240px;animation:spin 2s linear infinite;display:none}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}</style>
<script>if(typeof XMLHttpRequest==="undefined"){XMLHttpRequest=function(){try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}throw new Error("This browser does not support XMLHttpRequest.")}}function ge(b){return document.getElementById(b)}function ce(b){return document.createElement(b)}function sortByKey(b,a){return b.sort(function(e,d){var c=e[a];var f=d[a];return((c<f)?-1:((c>f)?1:0))})}var QueuedRequester=function(){this.queue=[];this.running=false;this.xmlhttp=null};QueuedRequester.prototype={_request:function(d){this.running=true;if(!d instanceof Object){return}var c=this;function a(f,g){return function(){if(f.readyState==4){ge("loader").style.display="none";g.callback(f.status,f.responseText);if(c.queue.length===0){c.running=false}if(c.running){c._request(c.queue.shift())}}}}ge("loader").style.display="block";var e="";if(d.params instanceof FormData){e=d.params}else{if(d.params instanceof Object){for(var b in d.params){if(e===""){e+=(d.method==="GET")?"?":""}else{e+="&"}e+=encodeURIComponent(b)+"="+encodeURIComponent(d.params[b])}}}this.xmlhttp=new XMLHttpRequest();this.xmlhttp.onreadystatechange=a(this.xmlhttp,d);if(d.method==="GET"){this.xmlhttp.open(d.method,d.url+e,true);this.xmlhttp.send()}else{this.xmlhttp.open(d.method,d.url,true);if(e instanceof String){this.xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded")}this.xmlhttp.send(e)}},stop:function(){if(this.running){this.running=false}if(this.xmlhttp&&this.xmlhttp.readyState<4){this.xmlhttp.abort()}},add:function(d,a,b,c){this.queue.push({url:a,method:d,params:b,callback:c});if(!this.running){this._request(this.queue.shift())}}};var requests=new QueuedRequester();function createFileUploader(c,m,f){var e;var h=ce("button");h.innerHTML="Refresh List";ge(c).appendChild(h);var j=ce("input");j.type="file";j.multiple=false;j.name="data";j.id="upload-select";ge(c).appendChild(j);var l=ce("input");l.id="upload-path";l.type="text";l.name="path";l.defaultValue="/";ge(c).appendChild(l);var d=ce("button");d.innerHTML="Upload";ge(c).appendChild(d);var b=ce("button");b.innerHTML="Create";ge(c).appendChild(b);var a=ce("input");a.id="editor-filename";a.type="text";a.disabled=true;a.size=20;ge(c).appendChild(a);var i=ce("button");i.innerHTML=" Save ";ge(c).appendChild(i);function k(n,o){if(n!=200){alert("ERROR["+n+"]: "+o)}else{m.refreshPath(l.value)}}function g(o){var n=new FormData();n.append("path",o);requests.add("PUT","/edit",n,k)}b.onclick=function(n){g(l.value);f.loadUrl(l.value);l.value="/"};i.onclick=function(n){f.execCommand("saveCommand")};h.onclick=function(n){m.refreshPath(l.value)};d.onclick=function(p){if(j.files.length===0){return}var o=new FormData();o.append("data",j.files[0],l.value);requests.add("POST","/edit",o,k);var q=ge("upload-path");q.value="/";var n=ge("upload-select");n.value=""};j.onchange=function(q){if(j.files.length===0){return}var n=j.files[0].name;var p=/(?:\.([^.]+))?$/.exec(n)[1];var o=/(.*)\.[^.]+$/.exec(n)[1];if(typeof o!==undefined){n=o}l.value="/"+n+"."+p}}function createTree(g,i){var k=ge("preview");var d=ce("div");d.className="tvu";ge(g).appendChild(d);function j(q){ge("download-frame").src="/edit?download="+q}function l(r){var q=ge("editor-filename");q.value=r;ge("editor").style.display="none";k.style.display="block";k.innerHTML='<img src="/edit?edit='+r+"&_cb="+Date.now()+'" style="max-width:100%; max-height:100%; margin:auto; display:block;" />'}function c(r,v){var u=ce("ul");r.appendChild(u);var t=ce("li");u.appendChild(t);if(v.slice(0,1)==="["){let dirFile=ce("li");u.appendChild(dirFile);dirFile.innerHTML="<span>Open directory</span>";let me=this;dirFile.onclick=function(w){me.refreshPath(v.slice(1,-1));if(document.body.getElementsByClassName("cm").length>0){document.body.removeChild(r)}}}else{if(n(v)){t.innerHTML="<span>Preview</span>";t.onclick=function(w){l(v);if(document.body.getElementsByClassName("cm").length>0){document.body.removeChild(r)}}}else{if(a(v)){t.innerHTML="<span>Edit</span>";t.onclick=function(w){i.loadUrl(v);if(document.body.getElementsByClassName("cm").length>0){document.body.removeChild(r)}}}}var q=ce("li");u.appendChild(q);q.innerHTML="<span>Download</span>";q.onclick=function(w){j(v);if(document.body.getElementsByClassName("cm").length>0){document.body.removeChild(r)}};var s=ce("li");u.appendChild(s);s.innerHTML="<span>Delete</span>";s.onclick=function(w){p(v);if(document.body.getElementsByClassName("cm").length>0){document.body.removeChild(r)}}}}function e(q,z,w){var r=ce("div");var t=document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop;var v=document.body.scrollLeft?document.body.scrollLeft:document.documentElement.scrollLeft;var u=q.clientX+v;var x=q.clientY+t;r.className="cm";r.style.display="block";r.style.left=u+"px";r.style.top=x+"px";c(r,z);document.body.appendChild(r);var s=r.offsetWidth;var y=r.offsetHeight;r.onmouseout=function(A){if(A.clientX<u||A.clientX>(u+s)||A.clientY<x||A.clientY>(x+y)){if(document.body.getElementsByClassName("cm").length>0){document.body.removeChild(r)}}}}function b(u,s,t){var q=ce("li");q.id=s;var r=ce("span");r.innerHTML=s;q.appendChild(r);q.onclick=function(v){if(a(q.id.toLowerCase())){i.loadUrl(q.id)}else{if(n(q.id.toLowerCase())){l(q.id)}}};q.oncontextmenu=function(v){v.preventDefault();v.stopPropagation();e(v,q.id,true)};return q}function h(s,v,q){sortByKey(q,"name");var t=ce("ul");s.appendChild(t);var u=q.length;for(var r=0;r<u;r++){if(q[r].type==="file"){t.appendChild(b(v,q[r].name,q[r].size))}if(q[r].type==="dir"){t.appendChild(b(v,"["+q[r].name+"]",q[r].size))}}}function a(r){var q=/(?:\.([^.]+))?$/.exec(r)[1];if(typeof q!==undefined){switch(q){case"txt":case"htm":case"html":case"js":case"css":case"xml":case"json":case"conf":case"ini":case"h":case"c":case"cpp":case"php":case"hex":case"ino":case"pde":return true}}return false}function n(r){var q=/(?:\.([^.]+))?$/.exec(r)[1];if(typeof q!==undefined){switch(q){case"png":case"jpg":case"gif":case"bmp":return true}}return false}this.refreshPath=function(q){if(d.childNodes[0]!=undefined){d.removeChild(d.childNodes[0])}o(d,q)};function m(q){return function(r,s){if(r!=200){alert("ERROR["+r+"]: "+s)}else{d.removeChild(d.childNodes[0]);o(d,"/")}}}function p(q){var r=new FormData();r.append("path",q);requests.add("DELETE","/edit",r,m(q))}function f(q,r){return function(s,u){if(s==200){try{h(q,r,JSON.parse(u))}catch(t){}}}}function o(q,r){requests.add("GET","/edit",{list:r},f(q,r))}o(d,"/");return this}function createEditor(e,c,a,d,g){function i(l){var n="plain";var m=/(?:\.([^.]+))?$/.exec(l)[1];if(typeof m!==undefined){switch(m){case"txt":n="plain";break;case"hex":n="plain";break;case"conf":n="plain";break;case"htm":n="html";break;case"js":n="javascript";break;case"h":n="c_cpp";break;case"c":n="c_cpp";break;case"cpp":n="c_cpp";break;case"css":case"scss":case"php":case"html":case"json":case"xml":case"ini":n=m}}return n}if(typeof c==="undefined"){c="/index.html"}if(typeof a==="undefined"){a=i(c)}if(typeof d==="undefined"){d="textmate"}if(typeof g==="undefined"){g="text/"+a;if(a==="c_cpp"){g="text/plain"}}var f=ace.edit(e);function k(l,m){if(l!=200){alert("ERROR["+l+"]: "+m)}}function b(l,n,m){var o=new FormData();o.append("data",new Blob([n],{type:m}),l);requests.add("POST","/edit",o,k)}function h(l,m){ge("preview").style.display="none";ge("editor").style.display="block";if(l==200){f.setValue(m)}else{f.setValue("")}f.clearSelection()}function j(l){requests.add("GET","/edit",{edit:l},h)}if(a!=="plain"){f.getSession().setMode("ace/mode/"+a)}f.setTheme("ace/theme/"+d);f.$blockScrolling=Infinity;f.getSession().setUseSoftTabs(true);f.getSession().setTabSize(2);f.setHighlightActiveLine(true);f.setShowPrintMargin(false);f.commands.addCommand({name:"saveCommand",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(l){b(c,l.getValue()+"",g)},readOnly:false});f.commands.addCommand({name:"undoCommand",bindKey:{win:"Ctrl-Z",mac:"Command-Z"},exec:function(l){l.getSession().getUndoManager().undo(false)},readOnly:false});f.commands.addCommand({name:"redoCommand",bindKey:{win:"Ctrl-Shift-Z",mac:"Command-Shift-Z"},exec:function(l){l.getSession().getUndoManager().redo(false)},readOnly:false});f.loadUrl=function(m){var l=ge("editor-filename");l.value=m;c=m;a=i(c);g="text/"+a;if(a!=="plain"){f.getSession().setMode("ace/mode/"+a)}j(c)};return f}var tree;function onBodyLoad(){var c={};var b=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(d,e,f){c[e]=f});var a=createEditor("editor",c.file,c.lang,c.theme);tree=createTree("tree",a);createFileUploader("uploader",tree,a);if(typeof c.file==="undefined"){c.file="/index.htm"}a.loadUrl(c.file)}</script>
<script id=ace src=https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js type=text/javascript charset=utf-8></script>
<script>if(typeof ace.edit=="undefined"){var script=document.createElement("script");script.src="/ace.js";script.async=false;document.head.appendChild(script)};</script>
</head>
<body onload=onBodyLoad()>
<div id=loader class=loader></div>
<div id=uploader></div>
<div id=tree></div>
<div id=editor></div>
<div id=preview style=display:none></div>
<iframe id=download-frame style=display:none></iframe>
</body>
</html>